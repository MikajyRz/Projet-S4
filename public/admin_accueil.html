<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Administration - Gestion des Fonds et Types de Prêt</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4">Gestion des Fonds et Types de Prêt</h1>
        
        <!-- Formulaire pour ajouter des fonds -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-xl font-semibold mb-4">Ajouter des fonds</h2>
            <form id="addFondsForm" class="space-y-4">
                <div>
                    <label for="montant" class="block text-sm font-medium text-gray-700">Montant (€)</label>
                    <input type="number" step="0.01" min="0.01" id="montant" name="montant" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                           required>
                </div>
                <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    Ajouter
                </button>
            </form>
            <div id="messageFonds" class="mt-4 hidden text-sm"></div>
        </div>
        
        <!-- Formulaire pour créer un type de prêt -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">Créer un type de prêt</h2>
            <form id="createTypePretForm" class="space-y-4">
                <div>
                    <label for="libelle" class="block text-sm font-medium text-gray-700">Nom du prêt</label>
                    <input type="text" id="libelle" name="libelle" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                           required>
                </div>
                <div>
                    <label for="taux_annuel" class="block text-sm font-medium text-gray-700">Taux d’intérêt (%)</label>
                    <input type="number" step="0.01" min="0" max="100" id="taux_annuel" name="taux_annuel" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                           required>
                </div>
                <div>
                    <label for="duree_max_mois" class="block text-sm font-medium text-gray-700">Durée maximale (mois)</label>
                    <input type="number" min="1" step="1" id="duree_max_mois" name="duree_max_mois" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                           required>
                </div>
                <div>
                    <label for="montant_min" class="block text-sm font-medium text-gray-700">Montant minimal (€)</label>
                    <input type="number" step="0.01" min="0" id="montant_min" name="montant_min" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                           required>
                </div>
                <div>
                    <label for="montant_max" class="block text-sm font-medium text-gray-700">Montant maximal (€)</label>
                    <input type="number" step="0.01" min="0" id="montant_max" name="montant_max" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                           required>
                </div>
                <button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                    Créer le type de prêt
                </button>
            </form>
            <div id="messageTypePret" class="mt-4 hidden text-sm"></div>
        </div>
    </div>

    <script>
        const apiBase = "http://localhost/Projet-S4/ws";

        // Gestion du formulaire d'ajout de fonds
        document.getElementById('addFondsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const montant = document.getElementById('montant').value;
            const messageDiv = document.getElementById('messageFonds');

            // Validation côté client
            if (!montant || parseFloat(montant) <= 0) {
                messageDiv.classList.remove('hidden', 'text-green-500');
                messageDiv.classList.add('text-red-500');
                messageDiv.textContent = 'Veuillez entrer un montant positif.';
                return;
            }

            try {
                const response = await fetch(`${apiBase}/fonds`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ montant: parseFloat(montant) })
                });

                const result = await response.json();
                
                messageDiv.classList.remove('hidden');
                if (response.ok) {
                    messageDiv.classList.remove('text-red-500');
                    messageDiv.classList.add('text-green-500');
                    messageDiv.textContent = result.message;
                    document.getElementById('addFondsForm').reset();
                } else {
                    messageDiv.classList.remove('text-green-500');
                    messageDiv.classList.add('text-red-500');
                    messageDiv.textContent = result.error || 'Erreur lors de l\'ajout des fonds.';
                }
            } catch (error) {
                messageDiv.classList.remove('hidden', 'text-green-500');
                messageDiv.classList.add('text-red-500');
                messageDiv.textContent = 'Erreur de connexion au serveur.';
            }
        });

        // Gestion du formulaire de création de type de prêt
        document.getElementById('createTypePretForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const libelle = document.getElementById('libelle').value.trim();
            const taux_annuel = document.getElementById('taux_annuel').value;
            const duree_max_mois = document.getElementById('duree_max_mois').value;
            const montant_min = document.getElementById('montant_min').value;
            const montant_max = document.getElementById('montant_max').value;
            const messageDiv = document.getElementById('messageTypePret');

            // Validation côté client
            if (!libelle) {
                messageDiv.classList.remove('hidden', 'text-green-500');
                messageDiv.classList.add('text-red-500');
                messageDiv.textContent = 'Le nom du prêt est requis.';
                return;
            }
            if (!taux_annuel || parseFloat(taux_annuel) < 0 || parseFloat(taux_annuel) > 100) {
                messageDiv.classList.remove('hidden', 'text-green-500');
                messageDiv.classList.add('text-red-500');
                messageDiv.textContent = 'Le taux d’intérêt doit être entre 0 et 100.';
                return;
            }
            if (!duree_max_mois || parseInt(duree_max_mois) <= 0) {
                messageDiv.classList.remove('hidden', 'text-green-500');
                messageDiv.classList.add('text-red-500');
                messageDiv.textContent = 'La durée maximale doit être un entier positif.';
                return;
            }
            if (!montant_min || parseFloat(montant_min) < 0 || !montant_max || parseFloat(montant_max) < 0 || parseFloat(montant_min) > parseFloat(montant_max)) {
                messageDiv.classList.remove('hidden', 'text-green-500');
                messageDiv.classList.add('text-red-500');
                messageDiv.textContent = 'Les montants doivent être positifs et le minimum ne peut pas dépasser le maximum.';
                return;
            }

            try {
                const response = await fetch(`${apiBase}/type_pret`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        libelle,
                        taux_annuel: parseFloat(taux_annuel),
                        duree_max_mois: parseInt(duree_max_mois),
                        montant_min: parseFloat(montant_min),
                        montant_max: parseFloat(montant_max)
                    })
                });

                const result = await response.json();
                
                messageDiv.classList.remove('hidden');
                if (response.ok) {
                    messageDiv.classList.remove('text-red-500');
                    messageDiv.classList.add('text-green-500');
                    messageDiv.textContent = result.message;
                    document.getElementById('createTypePretForm').reset();
                } else {
                    messageDiv.classList.remove('text-green-500');
                    messageDiv.classList.add('text-red-500');
                    messageDiv.textContent = result.error || 'Erreur lors de la création du type de prêt.';
                }
            } catch (error) {
                messageDiv.classList.remove('hidden', 'text-green-500');
                messageDiv.classList.add('text-red-500');
                messageDiv.textContent = 'Erreur de connexion au serveur.';
            }
        });
    </script>
</body>
</html>